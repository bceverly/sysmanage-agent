# SysManage Agent Configuration
# This file contains the configuration for the sysmanage-agent client

# Server connection settings
server:
  # Hostname or IP address of the SysManage server  
  hostname: "localhost"
  
  # Port number for the SysManage server
  port: 8080
  
  # Use HTTP for development mode (no SSL certificates needed)
  use_https: false
  
  # SSL verification not needed for HTTP
  verify_ssl: false
  
# Client identification settings
client:
  # Optional: Override the system hostname detection
  # If not specified, the agent will auto-detect the system hostname
  # hostname_override: "my-custom-hostname"
  
  # Registration retry settings
  registration_retry_interval: 30  # seconds between registration attempts
  max_registration_retries: 10     # maximum number of retry attempts (-1 for infinite)
  
  # Update check settings
  update_check_interval: 3600      # seconds between update checks (default: 1 hour)

  # Package collection settings
  package_collection_interval: 86400  # seconds between package collection runs (default: 24 hours/daily)
  package_collection_enabled: true    # enable/disable automatic package collection
  package_collection_at_startup: true # collect packages at agent startup

# Internationalization settings
i18n:
  # Language/locale for agent messages and logging
  # Supported languages: en, es, fr, de, it, pt, nl, ja, zh_CN, ko, ru
  language: "en"

# Logging configuration
logging:
  # Log levels to include: DEBUG, INFO, WARNING, ERROR, CRITICAL
  # Can combine multiple levels with pipe: "INFO|WARNING|ERROR|CRITICAL"
  # Examples: "DEBUG" (debug only), "INFO|ERROR" (info and errors only), 
  #          "WARNING|ERROR|CRITICAL" (warnings and above)
  level: "INFO|WARNING|ERROR|CRITICAL"
  
  # Log to file (default is logs/* in service directory)
  # file: "/var/log/sysmanage-agent.log"
  
  # Log format - customize the log message appearance
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# WebSocket connection settings (for real-time communication)
websocket:
  # Auto-reconnect on connection loss
  auto_reconnect: true
  
  # Reconnection interval in seconds
  reconnect_interval: 5
  
  # Ping interval to keep connection alive (increased to handle large message transmission)
  ping_interval: 60

# Database configuration
database:
  # Path to the agent's SQLite database file
  # If not specified, defaults to "agent.db" in the agent's working directory
  path: "agent.db"
  
  # Whether to automatically run database migrations on startup
  auto_migrate: true

# Message queue configuration
message_queue:
  # Message expiration timeout in minutes (default: 60)
  # Messages older than this will be marked as expired and no longer processed
  expiration_timeout_minutes: 60
  
  # Cleanup interval in minutes (default: 30) 
  # How often to check for and clean up expired messages
  cleanup_interval_minutes: 30

# Script execution configuration
# SECURITY NOTICE: Script execution is disabled by default for security reasons
# Only enable this feature if you trust the server administrators and understand the risks
script_execution:
  # Enable or disable script execution functionality
  # Setting this to false (default) completely disables script execution
  enabled: true
  
  # Maximum script execution timeout in seconds (default: 300 = 5 minutes)
  # Scripts that run longer than this will be terminated
  timeout: 300
  
  # Maximum number of concurrent script executions allowed
  # This prevents resource exhaustion from multiple simultaneous scripts
  max_concurrent: 3
  
  # Allowed shells for script execution
  # Only these shells will be permitted for script execution
  # Remove or comment out shells you don't want to allow
  allowed_shells:
    - "bash"        # Default shell on most Linux systems
    - "sh"          # POSIX shell
    - "zsh"         # macOS default shell and popular Linux shell
  
  # User execution restrictions (only applies when agent runs as root)
  user_restrictions:
    # Allow script execution as different users (requires agent to run as root)
    allow_user_switching: false
    
    # List of users that scripts are allowed to run as
    # Empty list means any user is allowed (if allow_user_switching is true)
    # This is a security feature to limit which users scripts can impersonate
    allowed_users: []
  
  # Security restrictions
  security:
    # Prevent scripts from accessing sensitive files/directories
    # This is advisory - actual enforcement depends on user permissions
    restricted_paths:
      - "/etc/passwd"
      - "/etc/shadow" 
      - "/etc/ssh/"
      - "/home/*/.ssh/"
      - "/root/.ssh/"
      - "*.key"
      - "*.pem"
    
    # Log all script executions for audit purposes
    audit_logging: true
    
    # Require explicit approval for each script execution
    # If true, scripts will be queued for manual approval
    require_approval: false

# Data collection settings
collection:
  # Enable collection of system information
  enabled: true

  # Collection intervals (in seconds)
  intervals:
    system_info: 300      # 5 minutes
    software: 3600        # 1 hour
    hardware: 1800        # 30 minutes
    network: 300          # 5 minutes
    users: 1800           # 30 minutes
    available_packages: 86400  # 24 hours (daily collection of available packages)

  # Types of data to collect
  types:
    software_packages: true
    system_updates: true
    hardware_info: true
    network_interfaces: true
    user_accounts: true
    system_metrics: true
    available_packages: true  # Collect available packages from package managers

